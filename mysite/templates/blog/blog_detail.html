{% extends 'base.html' %}

{# 页面标题 #}
{% block title %}
{{ blog.title }}
{% endblock %}

{# 页面内容 #}
 {% block content %}
 <h3>{{ blog.title }}</h3>
    <p>作者：{{ blog.author }}</p>
    <p>发表日期：{{ blog.created_time|date:"Y-m-d H:n:s" }}</p>
    <p>类型：
        <a href="{% url 'blogs_with_type' blog.blog_type.pk %}">
            {{ blog.blog_type }}
        </a>
    </p>
    <p>{{ blog.content }}</p>

    <form class="comment-form" id="jsStayForm">

        <div class="form-group">
          <label class="name">名字:  </label>
          <input name="name" type="text" class="form-name" id="js-name" placeholder="不超过20个字">
  
        </div>
        <div class="form-group">
          <label class="comment">评论:</label>
          <textarea name="content" class="form-control" id="js-content" rows="5" placeholder="不超过300个字"></textarea>
  
        </div>
          <input name="blog" type="hidden" id="js-name" value="{{ blog.id }}">
          <p class="error company-tips" id="jsCompanyTips"></p>
  
          <button class="btn" type="button" id="jsStayBtn" value="发表">发表</button>
      </form>

      <div class="#">
        <h3 class="comment-list-title">共 <span>{{ comment_nums }}</span> 条评论</h3>
        <ul class="comment-list">
    
            {% for comment in all_comment %}
                <li class="comment-item">
                <hr class="the-line"  />
                    <span class="nickname">{{ comment.name }} - </span>
                    <time class="submit-date"
                          datetime="{{ comment.create_time }}">{{ comment.create_time|date:"Y/m/d   h:m" }}</time>
                    <p class="floor">{{ forloop.counter }} #  </p>
                    <div style="word-wrap: break-word">
                            {{ comment.content }}
                    </div>
    
                </li>
            {% empty %}
                暂无评论
            {% endfor %}
    
        </ul>
        </div>
    
    </div>
    {% endblock %}
    
    
    {% block content_js %}
    <script>
        $(function(){
            $('#jsStayBtn').on('click', function(){
                $.ajax({
                    cache: false,
                    type: "POST",
                    url:"{{ blog.id }}/comment",
                    data:$('#jsStayForm').serialize(),
                    dateType:"json",
                    async: true,
                    beforeSend:function(xhr, settings){
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                },
                    success: function(data) {
                        if(data.status == 'success'){
                            alert("提交成功");
                             window.location.reload();//刷新当前页面.
                        }else if(data.status == 'fail'){
                            alert("评论错误，请重新评论");
                        }
                    },
                });
            });
        })
    </script>
    
    
    
{% endblock %}
